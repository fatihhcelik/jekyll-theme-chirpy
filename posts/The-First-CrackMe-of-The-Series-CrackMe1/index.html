<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="The First CrackMe of The Series - CrackMe1" /><meta name="author" content="Fatih Çelik" /><meta property="og:locale" content="en_US" /><meta name="description" content="1 - Starting The CrackMe Series - Why? 2 - The First CrackMe of The Series - CrackMe1 –&gt; You are here" /><meta property="og:description" content="1 - Starting The CrackMe Series - Why? 2 - The First CrackMe of The Series - CrackMe1 –&gt; You are here" /><link rel="canonical" href="https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/" /><meta property="og:url" content="https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/" /><meta property="og:site_name" content="Fatih’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-09T11:33:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The First CrackMe of The Series - CrackMe1" /><meta name="twitter:site" content="@fatihclk01" /><meta name="twitter:creator" content="@Fatih Çelik" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Fatih Çelik"},"headline":"The First CrackMe of The Series - CrackMe1","dateModified":"2021-03-05T20:05:46+08:00","datePublished":"2020-08-09T11:33:00+08:00","description":"1 - Starting The CrackMe Series - Why? 2 - The First CrackMe of The Series - CrackMe1 –&gt; You are here","url":"https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/"},"@context":"https://schema.org"}</script><title>The First CrackMe of The Series - CrackMe1 | Fatih's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Fatih's Blog</a></div><div class="site-subtitle font-italic">Random things about computer security</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/fatihhcelik" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/fatihclk01" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['fcelik.ft','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>The First CrackMe of The Series - CrackMe1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>The First CrackMe of The Series - CrackMe1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 9, 2020, 11:33 AM +0800" > Aug 9, 2020 <i class="unloaded">2020-08-09T11:33:00+08:00</i> </span> by <span class="author"> Fatih Çelik </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Mar 5, 2021, 3:05 PM +0300" > Mar 5 <i class="unloaded">2021-03-05T20:05:46+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1747 words">9 min</span></div></div><div class="post-content"><ul><li><a href="https://fatihhcelik.github.io/posts/Starting-The-CrackMe-Series-Why/">1 - Starting The CrackMe Series - Why?</a><li>2 - The First CrackMe of The Series - CrackMe1 –&gt; <strong>You are here</strong></ul><hr /><p><strong>Filename</strong>: CrackMe1.exe</p><p><strong>Architecture</strong>: x64</p><p><strong>Source</strong>: <a href="https://github.com/fatihhcelik/MyCrackMes">Github</a></p><p><strong>MD5</strong>: ACAB0D5D36D2780C173B8C76CEE1B2F3</p><p><strong>SHA-1</strong>: F428776AEFCA26CF1C64175260FC8FA75D8CCCD9</p><hr /><p>Before go to the executable, you can find all of my crackmes in my <a href="https://github.com/fatihhcelik/MyCrackMes">github</a> repository (you can see  in the header of the post as a source link) as an executable and source code. You can look at the source code of the challenge but it will give you spoiler so I don’t recommend until the end of the post.</p><p>Most of the time, I will use <a href="https://github.com/NationalSecurityAgency/ghidra">Ghidra</a> and <a href="https://github.com/radareorg/radare2">Radare2</a> because they are free so you can reproduce the same steps with the same tools. But if you want to learn how to use Radare2, Ghidra or any tools in this post, I will not cover the usage of the tools right now. In addition to that, sometimes we can use the <a href="https://www.hex-rays.com/products/ida/support/download_freeware/">IDA Freeware</a>.</p><p>Firstly, I can use the “file” tool to get basic information from the executable.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>file .<span class="se">\C</span>rackMe1.exe
.<span class="se">\C</span>rackMe1.exe<span class="p">;</span> PE32+ executable <span class="k">for </span>MS Windows <span class="o">(</span>console<span class="o">)</span> Mono/.Net assembly
</pre></table></code></div></div><p>In addition to that, we can use the “rabin2” from radare2.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-1.png" alt="rabin2 usage" /></p><p>I will open the Ghidra and look at the assembly code. I will not use decompiler window before look at the assembly version of the code. After understanding the code(or after failing to understand, i hope this will be not the case) I will look at the pseudocode.</p><p>Our executable is approximately 55K so finding the main function is pretty easy as you can see below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-2.png" alt="ghidra" /></p><p>Before diving into all of the functions I will look at the function call graph to understand big picture.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-3.png" alt="call graph" /></p><p>As you can see above, executable probably consists of 3 important functions which are main -&gt; read_from_file -&gt; validate_license. After that, I will look at the graph view of the read_from_file and validate_license functions to understand their size.</p><p><em>read_from_file,</em></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-4.png" alt="call graph" /></p><p><em>validate_license,</em></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-5.png" alt="" /></p><p>I know they are not legible but don’t worry I’ll take a closer look at these graphs. As you can see above, my guess the heavy work is in the validate_license function probably this function is responsible more than one license control. Now, I will look at the assembly code of the main.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-6.png" alt="" /></p><p>As we know, firstly the prologue part is coming, after that the address of the “license.txt” string is copied to _Argc which is probably the label assigned by Ghidra to ECX register and this variable is the first argument of the read_from_file function. What we know until this step, there is a function named read_from_file and it want probably one argument which is the filename to read of its content. Let’s look at the decompiler window of the main function.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-7.png" alt="" /></p><p>Now, I will go to the read_from_file function.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-8.png" alt="" /></p><p>As you can see from the graph, we should trace the green arrows to access <strong>validate_license</strong> function. Let’s go to step by step from the first box. After the prologue, there are 2 things that catch my attention.</p><p><strong>00401583 LEA         RDX,[DAT_0040400c]</strong></p><p><strong>0040158a MOV       param_1,qword ptr [RBP + local_res8]</strong></p><p><strong>0040158e CALL      fopen</strong></p><p><em>Signature of the fopen function,</em></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">FILE</span> <span class="o">*</span> <span class="nf">fopen</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">filename</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">mode</span> <span class="p">);</span>
</pre></table></code></div></div><p>Firstly, we see the [DAT_0040400c], this is probably the second argument of the fopen function because as a x64 Windows calling convention the first argument is copied to RCX and the second one to RDX. We know that the first argument of the fopen function is filename so param_1 is the name of the file to be read. As you can see above from the signature of the function, second argument is the mode. If we go to the address of the label DAT_0040400c, we can see the mode char variable. As you can see below, the file will be opened in read mode (“r”), this makes sense.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-9.png" alt="" /></p><p><strong>00401593 MOV    qword ptr [RBP + local_10],RAX</strong></p><p><strong>00401597 CMP     qword ptr [RBP + local_10],0x0</strong></p><p><strong>0040159c JNZ       LAB_004015b4</strong></p><p>After that, the return value of the fopen function will be stored at RAX register and compare with the 0x0 value. This is probably controlling the file’s existence because fopen function return NULL if can’t find the specified file. If the program can’t find the file, prints the “Where is the file!” message to the console.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-10.png" alt="" /></p><p>So we will create the license.txt file to be able to bypass this.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-11.png" alt="" /></p><p>As you can see above, I created the license.txt and the error message is changed. So, now, we will analyze the LAB_004015b4 graph.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-12.png" alt="" /></p><p><em>Signature of the fscanf function,</em></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">fscanf</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...)</span>
</pre></table></code></div></div><p><em>Signature of the fclose function,</em></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">fclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">)</span>
</pre></table></code></div></div><p>What we know until here is we have to create license.txt file in the same directory with executable. Our new goal is go to the validate_license function. There is couple of interesting things in LAB_004015b4,</p><p><strong>004015b4 LEA       RDX=&gt;local_78,[RBP + -0x70]</strong></p><p><strong>004015b8 MOV      RAX,qword ptr [RBP + local_10]</strong></p><p><strong>004015bc MOV      R8,RDX</strong></p><p><strong>004015bf LEA         RDX,[s_%[^_]_00404021]</strong></p><p><strong>004015c6 MOV       param_1,RAX</strong></p><p><strong>004015c9 CALL      fscanf</strong></p><p>Firstly, we know that function parameters will be stored at RCX,RDX and R8 if there is 3 parameters as a x64 Windows calling convention.</p><p><strong>RCX</strong> –&gt; Filename</p><p><strong>RDX</strong> –&gt; Format</p><p><strong>R8</strong> –&gt; Content of the file</p><p>You might be curious about what is format? If we go to the “<strong>s_%[^_]_00404021”</strong> label, we can learn the format specifier value.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-13.png" alt="" /></p><p>Format value is the “%[^\n]”, this means <strong>fscanf</strong> function just reads the file’s first line. (Until to the new line character which is \n) So we know that, license.txt file should have just one line in it.</p><p><strong>004015d5 CALL      fclose</strong></p><p><strong>004015da MOV       dword ptr [RBP + local_14],EAX</strong></p><p><strong>004015dd CMP       dword ptr [RBP + local_14],0x0</strong></p><p><strong>004015e1 JZ            LAB_004015f9</strong></p><p>After that, <strong>fclose</strong> function will try to close the opened file, if the return value of the <strong>fclose</strong> isn’t 0x0, we will go to the validate_license function. So we will go to the LAB_004015f9,</p><p><strong>004015f9 LEA          RAX=&gt;local_78,[RBP + -0x70]</strong></p><p><strong>004015fd MOV        param_1,RAX</strong></p><p><strong>00401600 CALL      validate_license</strong></p><p>[RBP+-0x70] kept the content of the file because R8 register pointed to that location. So, validate_license function will be called with just one parameter which is the content of the file.(content of the file = license key) This is the decompiler view of the read_from_file function, if you want to look at it. (Obviously, I replaced some of the variable names with their meaningful equivalents.)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-14.png" alt="" /></p><p>Yeah, if you remember the graph view of the validate_license function, it may seem scary. Let’s look at it step by step.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-15.png" alt="" /></p><p><em>Signature of the strlen function,</em></p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">size_t</span> <span class="n">strlen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
</pre></table></code></div></div><p>We see some strings and 2 strlen function call in validate_license function.</p><p><strong>00401646 MOV       param_1,qword ptr [RBP]=&gt;local_res8</strong></p><p><strong>0040164a CALL      strlen</strong></p><p><strong>0040164f MOV       dword ptr [RBP + local_4c],EAX</strong></p><p><strong>param_1</strong> is the license key read from the license.txt file. First strlen function gets the length of the license key and stores it in [RBP+local_4c].</p><p><strong>0040164f MOV        dword ptr [RBP + local_4c],EAX</strong></p><p><strong>00401652 MOV       dword ptr [RBP + local_1c],0x0</strong></p><p><strong>00401659 MOV       param_1,qword ptr [RBP]=&gt;local_res8</strong></p><p><strong>0040165d CALL      strlen</strong></p><p><strong>00401662 CMP        RAX,0x17</strong></p><p><strong>00401666 JZ            LAB_0040167e</strong></p><p>After that, strlen function is called again with the same parameter(actually there was no need to do this, this could use the [RBP+local_4c] value but nevermind :) and gets the length of the license key. After that compares the license key with the 0x17 which is  23. So, we learn that the license key should be 23 character length.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-16.png" alt="" /></p><p>To summarize the 4 graphs above, program take the first 7 bytes of the license key and compares with “#BEGIN#” one by one. So, we know that the license key should be started with #BEGIN# string. After this point, it will be very difficult to explain code with graph view due to the excessive amount of graphics so I will be using the decompiler view.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">validate_license</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">length</span><span class="p">;</span>
  <span class="n">ulonglong</span> <span class="n">uVar1</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">key_temp</span> <span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">_length</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">begin</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">encoded</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">_counter</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">local_28</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">reverse_counter</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">counter</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">another_counter</span><span class="p">;</span>

  <span class="n">encoded</span> <span class="o">=</span> <span class="s">"QnhjsxjYj}y"</span><span class="p">;</span>
  <span class="n">begin</span> <span class="o">=</span> <span class="s">"#BEGIN#"</span><span class="p">;</span>
  <span class="n">end</span> <span class="o">=</span> <span class="s">"#END#"</span><span class="p">;</span>

  <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
  <span class="n">_length</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">length</span><span class="p">;</span>
  <span class="n">another_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">!=</span> <span class="mh">0x17</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"The license key is not correct."</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">begin</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">!=</span> <span class="n">key</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"The license key is not correct."</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">reverse_counter</span> <span class="o">=</span> <span class="n">_length</span> <span class="o">+</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">reverse_counter</span> <span class="o">&lt;</span> <span class="n">_length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">end</span><span class="p">[</span><span class="n">another_counter</span><span class="p">]</span> <span class="o">!=</span> <span class="n">key</span><span class="p">[</span><span class="n">reverse_counter</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"The license key is not correct."</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">another_counter</span> <span class="o">=</span> <span class="n">another_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">reverse_counter</span> <span class="o">=</span> <span class="n">reverse_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">another_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_28</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">local_28</span> <span class="o">&lt;</span> <span class="mh">0x12</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">key_temp</span><span class="p">[</span><span class="n">another_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">local_28</span><span class="p">];</span>
    <span class="n">another_counter</span> <span class="o">=</span> <span class="n">another_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">local_28</span> <span class="o">=</span> <span class="n">local_28</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">uVar1</span> <span class="o">=</span> <span class="n">SEXT48</span><span class="p">(</span><span class="n">_counter</span><span class="p">);</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">encoded</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">uVar1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Congratz!"</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">encoded</span><span class="p">[</span><span class="n">_counter</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">key_temp</span><span class="p">[</span><span class="n">_counter</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="n">_counter</span> <span class="o">=</span> <span class="n">_counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"The license key is not correct."</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I replaced some of the variable names with the more appropriate ones. (sorry for the bad namings :)</p><p>After controls the beginning of the license key, program controls the end of the key with “#END#” string. So, we know that license key will start with “#BEGIN#” and end with “#END#”.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-17.png" alt="" /></p><p>As a result, program decodes the encoded string substracting 5 from their ascii value.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-18.png" alt="" /></p><p>So, I can write the python code just gives us the license key like below.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">encoded</span> <span class="o">=</span> <span class="s">"QnhjsxjYj}y"</span>
<span class="n">end</span> <span class="o">=</span> <span class="s">"#END#"</span>
<span class="n">license_key</span> <span class="o">=</span> <span class="s">"#BEGIN#"</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">encoded</span><span class="p">:</span>
    <span class="n">license_key</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>

<span class="n">license_key</span> <span class="o">+=</span> <span class="n">end</span>
<span class="k">print</span><span class="p">(</span><span class="n">license_key</span><span class="p">)</span>
</pre></table></code></div></div><p>The key is,</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-19.png" alt="" /></p><p>So, I will put this string into the license.txt.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/photos/crackme-1-20.png" alt="" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/reverse-engineering/'>Reverse Engineering</a>, <a href='/categories/crackme/'>Crackme</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/reverse-engineering/" class="post-tag no-text-decoration" >reverse engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The First CrackMe of The Series - CrackMe1 - Fatih's Blog&url=https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The First CrackMe of The Series - CrackMe1 - Fatih's Blog&u=https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=The First CrackMe of The Series - CrackMe1 - Fatih's Blog&url=https://fatihhcelik.github.io/posts/The-First-CrackMe-of-The-Series-CrackMe1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Group-Office-CRM-Stored-XSS-via-SVG-File/">Group Office CRM | Stored XSS via SVG File</a><li><a href="/posts/Group-Office-CRM-SSRF/">Group Office CRM | SSRF</a><li><a href="/posts/Division-By-Zero-Deark/">Division By Zero | Deark</a><li><a href="/posts/NULL-Pointer-Dereference-Deark/">NULL Pointer Dereference | Deark</a><li><a href="/posts/CMSUno-1.6.2-RCE-Authenticated-(password.php)-CVE-2020-25557/">CMSUno 1.6.2 | RCE [Authenticated] (password.php) | CVE-2020-25557</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/vulnerability-research/">vulnerability research</a> <a class="post-tag" href="/tags/reverse-engineering/">reverse engineering</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Starting-The-CrackMe-Series-Why/"><div class="card-body"> <span class="timeago small" > Aug 9, 2020 <i class="unloaded">2020-08-09T11:33:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Starting The CrackMe Series - Why?</h3><div class="text-muted small"><p> 1 - Starting The CrackMe Series - Why? –&gt; You are here 2- The First CrackMe of The Series - CrackMe1 What is the purpose of this series? I think the best way to learn reverse engineering is...</p></div></div></a></div><div class="card"> <a href="/posts/NULL-Pointer-Dereference-Deark/"><div class="card-body"> <span class="timeago small" > Mar 15 <i class="unloaded">2021-03-15T11:34:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>NULL Pointer Dereference | Deark</h3><div class="text-muted small"><p> Software: https://github.com/jsummers/deark/ Version: 1.5.7-1 Vulnerability: NULL Pointer Dereference CVE: CVE-2021-28855 Description of the product: A utility for file format and metadata ...</p></div></div></a></div><div class="card"> <a href="/posts/Division-By-Zero-Deark/"><div class="card-body"> <span class="timeago small" > Mar 15 <i class="unloaded">2021-03-15T11:33:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Division By Zero | Deark</h3><div class="text-muted small"><p> Version: 1.5.7-1 Bug: Division by Zero CVE: CVE-2021-28856 Description of the product: A utility for file format and metadata analysis, data extraction, decompression, and image format decod...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Starting-The-CrackMe-Series-Why/" class="btn btn-outline-primary" prompt="Older"><p>Starting The CrackMe Series - Why?</p></a> <a href="/posts/CMSUno-1.6.2-RCE-Authenticated-(config.php)-CVE-2020-25538/" class="btn btn-outline-primary" prompt="Newer"><p>CMSUno 1.6.2 | RCE [Authenticated] (config.php) | CVE-2020-25538</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/fatihclk01">Fatih Çelik</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/vulnerability-research/">vulnerability research</a> <a class="post-tag" href="/tags/reverse-engineering/">reverse engineering</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://fatihhcelik.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
